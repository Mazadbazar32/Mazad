<!DOCTYPE html>
<html lang="ckb" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Mazad Bazar — مزاد بازار</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0b1020">
  <link rel="icon" sizes="192x192" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <style>
    :root{
      --bg:#0b1020;--card:#0f172a;--muted:#93a3b8;--txt:#e5e7eb;
      --pri:#22c55e;--pri2:#16a34a;--brand:#6a0dad;--border:#1e293b;
      --danger:#ef4444;--warn:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%}
    body{
      font-family: system-ui, -apple-system, Segoe UI, Arial;
      background:var(--bg); color:var(--txt); line-height:1.6;
    }
    a{color:inherit; text-decoration:none}
    .container{max-width:1100px; margin:auto; padding:16px 20px}

    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(6px);
      background:rgba(11,16,32,.75);
      border-bottom:1px solid var(--border);
    }
    .row{display:flex; gap:14px; align-items:center; justify-content:space-between}
    .brand{display:flex; gap:10px; align-items:center}
    .badge{background:var(--brand); color:#fff; padding:6px 10px; border-radius:8px; font-weight:800}
    .nav{display:flex; gap:10px; flex-wrap:wrap}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:10px 14px; border:1px solid var(--border); border-radius:10px;
      background:#0f172a; color:var(--txt); cursor:pointer; font-weight:600;
      transition:.18s ease;
    }
    .btn:hover{transform:translateY(-1px); box-shadow:0 6px 16px rgba(0,0,0,.25)}
    .btn.pri{border-color:transparent; background:linear-gradient(135deg, var(--pri), var(--pri2))}
    .btn.warn{background:var(--warn); border-color:transparent; color:#111}
    .btn.danger{background:var(--danger); border-color:transparent}
    .btn.sm{padding:6px 10px; font-weight:700}
    input,select,textarea{
      width:100%; background:#0f172a; color:var(--txt);
      border:1px solid var(--border); border-radius:10px; padding:12px 12px;
    }
    textarea{min-height:110px; resize:vertical}
    .card{
      background:var(--card); border:1px solid var(--border);
      border-radius:16px; padding:16px;
    }
    .grid{display:grid; gap:16px}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    @media (max-width:900px){ .grid.cols-3{grid-template-columns:1fr} .row{flex-wrap:wrap} }
    .pill{padding:6px 10px; border-radius:999px; background:#101826; border:1px solid var(--border); font-weight:700}
    .muted{color:var(--muted)}
    .hr{height:1px;background:var(--border);margin:18px 0}
    .hide{display:none !important}
    .right{direction:rtl} .left{direction:ltr}
  </style>
</head>

<body>
<header>
  <div class="container row">
    <div class="brand">
      <div class="badge">MB</div>
      <div>
        <div style="font-size:18px;font-weight:900">Mazad – Bazar</div>
        <div class="muted" style="font-size:12px" data-i="tagline">پۆرتاڵی سادەی مزایدة</div>
      </div>
    </div>

    <div class="nav">
      <select id="lang" class="pill">
        <option value="ckb">کوردی</option>
        <option value="ar">العربية</option>
        <option value="en">English</option>
      </select>

      <button class="btn sm" id="btn-login"><span data-i="login">چوونەژوورەوە</span></button>
      <button class="btn sm warn hide" id="btn-logout"><span data-i="logout">چوونەدەرەوە</span></button>
      <button class="btn sm pri" id="btn-new"><span data-i="addItem">زیادکردنی کاڵا</span> ⊕</button>
    </div>
  </div>
</header>

<main class="container">

  <!-- HERO -->
  <section class="card" id="hero">
    <div class="row" style="align-items:flex-start">
      <div style="max-width:680px">
        <h2 style="margin:0 0 8px" data-i="welcomeTitle">🚀 بەخێربێیت بۆ «مزاد بازار»</h2>
        <p class="muted" data-i="welcomeDesc">
          پڕۆژەیەکی سادەی مزایدة. دەتوانیت کاڵا بنووسی، بە دوگمەی بید نرخ زیاد بکەی،
          و ئەدمین دەتوانێت پۆستەکان پشکنین بکات (قبوول / ڕەد).
        </p>
        <div class="hr"></div>
        <div class="pill left" style="display:inline-block">
          <b data-i="feeLabel">کرێی پۆستکردن:</b> <span id="fee">2000</span> IQD
          • <b>FastPay / FIB</b> → <span id="wallet">07827513551</span>
        </div>
      </div>
    </div>
  </section>

  <!-- CREATE / EDIT ITEM -->
  <section class="card hide" id="create">
    <h3 style="margin-top:0" data-i="createTitle">زیادکردنی پۆست</h3>
    <div class="grid">
      <label><span data-i="fTitle">ناونیشان</span>
        <input id="f-title" placeholder="…"/></label>
      <label><span data-i="fPrice">نرخی دەستپێک (IQD)</span>
        <input id="f-price" type="number" min="0" value="0"/></label>
      <label><span data-i="fCategory">هاوپۆل</span>
        <select id="f-cat">
          <option value="general" data-i="catGeneral">گشتی</option>
          <option value="phones" data-i="catPhones">مۆبایل</option>
          <option value="cars" data-i="catCars">ئۆتۆمبێل</option>
          <option value="digital" data-i="catDigital">دیجیتاڵ</option>
        </select>
      </label>
      <label style="grid-column:1/-1"><span data-i="fDesc">وەسف/زانیاری زۆرتر</span>
        <textarea id="f-desc" placeholder="…"></textarea></label>
      <label style="grid-column:1/-1"><span data-i="fImage">وێنە (URL یەک یان چەندین بە کۆما)</span>
        <input id="f-images" placeholder="https://… , https://…"/></label>

      <div class="hr" style="grid-column:1/-1"></div>

      <div style="grid-column:1/-1">
        <b data-i="payTitle">پارەدان بۆ ناردنی پۆست (2000 IQD):</b><br/>
        <label class="pill"><input type="radio" name="pay" value="FastPay" checked> FastPay</label>
        <label class="pill"><input type="radio" name="pay" value="FIB"> FIB</label>
        <div class="muted" style="margin-top:8px" data-i="payNote">
          تکایە 2000 IQD بۆ ژمارەی <b id="wallet2">07827513551</b> بنێرە و ژمارەی مامەڵە/رسید داخڵ بکە.
        </div>
      </div>

      <label style="grid-column:1/-1"><span data-i="fTxn">ژمارەی مامەڵە/رسید</span>
        <input id="f-txn" placeholder="#TXN12345"/></label>
    </div>
    <div class="row" style="margin-top:14px; justify-content:flex-end">
      <button class="btn" id="btn-cancel" data-i="cancel">هەڵوەشاندنەوە</button>
      <button class="btn pri" id="btn-save" data-i="submitPost">ناردنی پۆست</button>
    </div>
    <div class="muted" style="margin-top:10px" data-i="createFoot">
      تێبینی: ئەدمین پۆستەکە دەبینێت؛ دەتوانێت قبوول یان ڕەد بکات و هۆکار بنووسێت.
    </div>
  </section>

  <!-- LISTINGS -->
  <section class="grid cols-3" id="list"></section>

  <!-- ADMIN -->
  <section class="card hide" id="admin">
    <h3 style="margin:0 0 10px" data-i="adminTitle">لووحەی ئەdmین</h3>
    <details>
      <summary class="pill" data-i="pendingPosts">پۆستە چاوەڕوانەکان</summary>
      <div id="pending" class="grid" style="margin-top:14px"></div>
    </details>

    <div class="hr"></div>

    <details>
      <summary class="pill" data-i="settings">ڕێکخستنەکان</summary>
      <div class="grid" style="margin-top:10px">
        <label><span data-i="feeLabel">کرێی پۆستکردن (IQD)</span>
          <input id="set-fee" type="number" min="0" value="2000"></label>
        <label><span data-i="walletLabel">ژمارەی پارەوەران</span>
          <input id="set-wallet" value="07827513551"></label>
        <button class="btn pri" id="btn-save-settings" data-i="save">پاشەکەوت</button>
      </div>
    </details>

    <div class="hr"></div>

    <details id="super-block" class="hide">
      <summary class="pill">Super Admin</summary>
      <div class="grid" style="margin-top:10px">
        <label>Admins (comma separated usernames)
          <input id="set-admins" placeholder="admin,ali,dlshad"></label>
        <button class="btn pri" id="btn-save-admins" data-i="save">پاشەکەوت</button>
      </div>
    </details>
  </section>

</main>

<!-- AUTH MODAL (simple) -->
<div id="auth" class="hide" style="
  position:fixed; inset:0; background:rgba(0,0,0,.6);
  display:flex; align-items:center; justify-content:center;">
  <div class="card" style="width:min(520px,95vw)">
    <h3 style="margin-top:0" data-i="login">چوونەژوورەوە</h3>
    <div class="grid">
      <label><span data-i="username">ناوی بەکارهێنەر</span>
        <input id="u-name" placeholder="مثال: kurosh"/></label>
      <label><span data-i="password">وشەی نهێنی</span>
        <input id="u-pass" type="password" placeholder="…"/></label>
      <label><span data-i="role">ڕۆڵ</span>
        <select id="u-role">
          <option value="user" data-i="roleUser">بەکارهێنەر</option>
          <option value="admin" data-i="roleAdmin">ئەdmین</option>
          <option value="super" data-i="roleSuper">سووپەر ئەdmین</option>
        </select>
      </label>
    </div>
    <div class="row" style="margin-top:12px; justify-content:flex-end">
      <button class="btn" id="a-cancel" data-i="cancel">هەڵوەشاندنەوە</button>
      <button class="btn pri" id="a-ok" data-i="login">چوونەژوورەوە</button>
    </div>
    <div class="muted" style="margin-top:8px">
      demo:
      <code>super / super123 (سووپەر)</code> —
      <code>admin / admin123 (ئەdmین)</code>
    </div>
  </div>
</div>

<script>
/* ===== i18n ===== */
const T = {
  ckb:{
    tagline:"پۆرتاڵی سادەی مزایدة",
    welcomeTitle:"🚀 بەخێربێیت بۆ «مزاد بازار»",
    welcomeDesc:"پۆست بنووسە، بە دوگمەی بید نرخ زیاد بکە، ئەdmین دەتوانێت قبوول/ڕەد بکات.",
    login:"چوونەژوورەوە", logout:"چوونەدەرەوە", addItem:"زیادکردنی کاڵا",
    createTitle:"زیادکردنی پۆست", fTitle:"ناونیشان", fPrice:"نرخی دەستپێک (IQD)",
    fCategory:"هاوپۆل", catGeneral:"گشتی", catPhones:"مۆبایل", catCars:"ئۆتۆمبێل", catDigital:"دیجیتاڵ",
    fDesc:"وەسف/زانیاری", fImage:"وێنە (URL بە کۆما جیا بکە)", payTitle:"پارەدان",
    payNote:"تکایە 2000 IQD بۆ ژمارەکە بنێرە و ژمارەی مامەڵە داخڵ بکە.",
    fTxn:"ژمارەی مامەڵە", cancel:"هەڵوەشاندنەوە", submitPost:"ناردنی پۆست",
    createFoot:"پاش ناردن، پۆستەکە چاوەڕوانی قبوولکردنی ئەdmین دەبێت.",
    adminTitle:"لووحەی ئەdmین", pendingPosts:"پۆستە چاوەڕوانەکان", settings:"ڕێکخستنەکان",
    feeLabel:"کرێی پۆستکردن", walletLabel:"ژمارەی پارەوەران", save:"پاشەکەوت",
    username:"ناوی بەکارهێنەر", password:"وشەی نهێنی", role:"ڕۆڵ",
    roleUser:"بەکارهێنەر", roleAdmin:"ئەdmین", roleSuper:"سووپەر ئەdmین",
    bid:"+ زیادکردنی نرخ", approve:"قبوول", reject:"ڕەدکردن", reason:"هۆکار",
    by:"لەلایەن", payMethod:"شێوازی پارەدان", status:"دۆخ", pending:"چاوەڕوان",
    approved:"قبوولکرا", rejected:"ڕەدکرا"
  },
  ar:{
    tagline:"بوابة مزاد بسيطة",
    welcomeTitle:"🚀 أهلاً بك في «مزاد بازار»",
    welcomeDesc:"أضف منشوراً، زد السعر بزرّ المزايدة، والمدير يوافق أو يرفض.",
    login:"تسجيل الدخول", logout:"تسجيل الخروج", addItem:"إضافة سلعة",
    createTitle:"إضافة منشور", fTitle:"العنوان", fPrice:"السعر الابتدائي (IQD)",
    fCategory:"الفئة", catGeneral:"عام", catPhones:"هواتف", catCars:"سيارات", catDigital:"رقمي",
    fDesc:"الوصف/تفاصيل", fImage:"صورة (روابط مفصولة بفواصل)", payTitle:"الدفع",
    payNote:"ادفع 2000 دينار إلى الرقم أدناه وأدخل رقم العملية.",
    fTxn:"رقم العملية", cancel:"إلغاء", submitPost:"إرسال",
    createFoot:"بعد الإرسال ينتظر المنشور موافقة المدير.",
    adminTitle:"لوحة المدير", pendingPosts:"المنشورات المعلقة", settings:"الإعدادات",
    feeLabel:"رسوم النشر", walletLabel:"رقم الدفع", save:"حفظ",
    username:"اسم المستخدم", password:"كلمة السر", role:"الدور",
    roleUser:"مستخدم", roleAdmin:"مدير", roleSuper:"مدير أعلى",
    bid:"+ مزايدة", approve:"موافقة", reject:"رفض", reason:"السبب",
    by:"بواسطة", payMethod:"طريقة الدفع", status:"الحالة",
    pending:"معلّق", approved:"مقبول", rejected:"مرفوض"
  },
  en:{
    tagline:"Simple auction portal",
    welcomeTitle:"🚀 Welcome to Mazad Bazar",
    welcomeDesc:"Create a post, bid with one click, and admins can approve or reject.",
    login:"Login", logout:"Logout", addItem:"Add Item",
    createTitle:"Create Post", fTitle:"Title", fPrice:"Start Price (IQD)",
    fCategory:"Category", catGeneral:"General", catPhones:"Phones", catCars:"Cars", catDigital:"Digital",
    fDesc:"Description", fImage:"Images (URLs comma separated)", payTitle:"Payment",
    payNote:"Please pay 2000 IQD to the wallet below and enter your transaction id.",
    fTxn:"Transaction ID", cancel:"Cancel", submitPost:"Submit Post",
    createFoot:"After submission, the post waits for admin approval.",
    adminTitle:"Admin Panel", pendingPosts:"Pending posts", settings:"Settings",
    feeLabel:"Post Fee", walletLabel:"Wallet/Number", save:"Save",
    username:"Username", password:"Password", role:"Role",
    roleUser:"User", roleAdmin:"Admin", roleSuper:"Super Admin",
    bid:"+ Bid", approve:"Approve", reject:"Reject", reason:"Reason",
    by:"by", payMethod:"Payment", status:"Status",
    pending:"Pending", approved:"Approved", rejected:"Rejected"
  }
};
const $ = s=>document.querySelector(s);
const $$ = s=>document.querySelectorAll(s);
function tr(){ const L=T[state.lang]; $$('[data-i]').forEach(el=>{const k=el.getAttribute('data-i'); if(L[k]) el.textContent=L[k];}); document.documentElement.lang=state.lang; document.documentElement.dir=(state.lang==='en'?'ltr':'rtl'); }
$('#lang').addEventListener('change',e=>{state.lang=e.target.value; saveState(); tr(); render();});

/* ===== State / Storage ===== */
const LS = {
  load(key,def){ try{ return JSON.parse(localStorage.getItem(key)) ?? def; }catch{ return def; } },
  save(key,val){ localStorage.setItem(key, JSON.stringify(val)); }
};
let state = LS.load('mb_state',{
  lang:'ckb',
  session:null, // {name,role}
});
let db = LS.load('mb_db',{
  settings:{fee:2000,wallet:'07827513551',admins:['admin']},
  items:[] // {id,title,desc,images[],price,owner,method,txn,status,reason,bids:[]}
});
function saveDB(){ LS.save('mb_db',db); }
function saveState(){ LS.save('mb_state',state); }

/* ===== Auth (demo) ===== */
$('#btn-login').onclick = ()=>$('#auth').classList.remove('hide');
$('#a-cancel').onclick = ()=>$('#auth').classList.add('hide');
$('#a-ok').onclick = ()=>{
  const name=$('#u-name').value.trim(); const pass=$('#u-pass').value.trim(); const role=$('#u-role').value;
  // demo passwords
  const ok = (role==='super' && name==='super' && pass==='super123')
          || (role==='admin' && (db.settings.admins.includes(name)) && pass==='admin123')
          || (role==='user'  && name && pass);
  if(!ok){ alert('Login failed'); return; }
  state.session={name,role}; saveState(); $('#auth').classList.add('hide'); render();
};
$('#btn-logout').onclick = ()=>{ state.session=null; saveState(); render(); };

/* ===== Create Post ===== */
$('#btn-new').onclick = ()=>{
  if(!state.session){ $('#auth').classList.remove('hide'); return; }
  $('#create').classList.remove('hide'); window.scrollTo(0,0);
};
$('#btn-cancel').onclick = ()=>$('#create').classList.add('hide');
$('#btn-save').onclick = ()=>{
  const title=$('#f-title').value.trim();
  const price=Number($('#f-price').value||0);
  const desc=$('#f-desc').value.trim();
  const images=($('#f-images').value||'').split(',').map(s=>s.trim()).filter(Boolean);
  const txn=$('#f-txn').value.trim();
  const method=(document.querySelector('input[name=pay]:checked')||{}).value || 'FastPay';
  if(!title || !txn){ alert('Fill title & transaction'); return; }
  const it={ id:Date.now(), title, desc, images, price, owner:state.session?.name||'guest',
             method, txn, status:'pending', reason:'', bids:[] };
  db.items.unshift(it); saveDB();
  $('#create').classList.add('hide');
  alert('Post submitted. Waiting for admin.');
  render();
};

/* ===== Render Listings ===== */
function el(tag,props={}){ const x=document.createElement(tag); Object.assign(x,props); return x; }
function renderList(){
  const wrap = $('#list'); wrap.innerHTML='';
  db.items.filter(it=>it.status==='approved').forEach(it=>{
    const card=el('div',{className:'card'});
    const img = el('img',{src: it.images?.[0]||'https://picsum.photos/600/400?random='+it.id, alt:'', style:'width:100%;border-radius:12px'});
    const t   = el('h3',{textContent:it.title, style:'margin:10px 0 6px'});
    const by  = el('div',{className:'muted', innerHTML:`<b data-i="by">${T[state.lang].by}</b> ${it.owner}`});
    const p   = el('div',{className:'pill left', innerHTML:`IQD <b>${fmt(it.price)}</b>`});
    const row = el('div',{className:'row', style:'margin-top:10px'});
    const b1  = el('button',{className:'btn sm pri', innerText:`${T[state.lang].bid} 1k`});
    const b2  = el('button',{className:'btn sm pri', innerText:`${T[state.lang].bid} 5k`});
    b1.onclick=()=>bid(it,1000); b2.onclick=()=>bid(it,5000);
    row.append(b1,b2);
    card.append(img,t,by,p,row);
    wrap.append(card);
  });
}
function bid(it,inc){
  if(!state.session){ $('#auth').classList.remove('hide'); return; }
  it.price += inc; it.bids.push({by:state.session.name,inc,at:Date.now()}); saveDB(); renderList();
}
function fmt(n){ return (n||0).toLocaleString(); }

/* ===== Admin Panel ===== */
function renderAdmin(){
  const isAdmin = state.session && (state.session.role==='admin' || state.session.role==='super');
  $('#admin').classList.toggle('hide', !isAdmin);
  $('#super-block').classList.toggle('hide', !(state.session && state.session.role==='super'));
  if(!isAdmin) return;

  // settings
  $('#set-fee').value = db.settings.fee;
  $('#set-wallet').value = db.settings.wallet;
  $('#set-admins').value = (db.settings.admins||[]).join(',');

  // pending
  const p = $('#pending'); p.innerHTML='';
  db.items.filter(it=>it.status==='pending').forEach(it=>{
    const card=el('div',{className:'card'});
    card.innerHTML = `
      <div class="row">
        <div><b>${it.title}</b> — <span class="muted">${T[state.lang].by}: ${it.owner}</span></div>
        <span class="pill">${T[state.lang].payMethod}: ${it.method} • TXN: ${it.txn}</span>
      </div>
      <div class="muted" style="margin:6px 0">${it.desc||''}</div>
      <div class="row" style="justify-content:flex-end; gap:8px">
        <input class="pill" id="rea-${it.id}" placeholder="${T[state.lang].reason}" style="min-width:160px">
        <button class="btn sm danger" id="r-${it.id}">${T[state.lang].reject}</button>
        <button class="btn sm pri" id="a-${it.id}">${T[state.lang].approve}</button>
      </div>`;
    p.append(card);
    $(`#a-${it.id}`).onclick = ()=>{ it.status='approved'; it.reason=''; saveDB(); render(); };
    $(`#r-${it.id}`).onclick = ()=>{
      it.status='rejected'; it.reason=$(`#rea-${it.id}`).value||'—'; saveDB(); render();
    };
  });

  // save settings
  $('#btn-save-settings').onclick = ()=>{
    db.settings.fee = Number($('#set-fee').value||0);
    db.settings.wallet = $('#set-wallet').value.trim()||db.settings.wallet;
    saveDB(); render();
    alert('Saved.');
  };
  $('#btn-save-admins').onclick = ()=>{
    db.settings.admins = $('#set-admins').value.split(',').map(s=>s.trim()).filter(Boolean);
    saveDB(); alert('Admins updated.');
  };
}

/* ===== Header bits that depend on settings ===== */
function applySettings(){
  $('#fee').textContent = db.settings.fee;
  $('#wallet').textContent = db.settings.wallet;
  $('#wallet2').textContent = db.settings.wallet;
}

/* ===== Render Root ===== */
function render(){
  // session UI
  const logged = !!state.session;
  $('#btn-login').classList.toggle('hide', logged);
  $('#btn-logout').classList.toggle('hide', !logged);

  applySettings();
  tr();
  renderList();
  renderAdmin();
}
render();

/* ===== Register SW (optional if file exists) ===== */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js').catch(()=>{});
}
</script>
</body>
</html>
