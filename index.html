<!DOCTYPE html>
<html lang="ckb" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mazad Bazar – مزاد بازار</title>
<style>
:root{
  --bg:#0b1020;--card:#0f172a;--border:#1e293b;
  --txt:#e5e7eb;--muted:#93a3b8;
  --pri:#22c55e;--pri2:#16a34a;--brand:#6a0dad;
}
*{box-sizing:border-box} html,body{margin:0}
body{background:var(--bg);color:var(--txt);font-family:-apple-system,system-ui,Segoe UI,Arial;line-height:1.6}
a{color:inherit;text-decoration:none}
.container{max-width:1100px;margin:auto;padding:16px 20px}
header{position:sticky;top:0;z-index:20;background:rgba(11,16,32,.75);backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
.nav{display:flex;gap:14px;align-items:center;justify-content:space-between}
.brand{display:flex;gap:10px;align-items:center}
.badge{background:var(--brand);color:#fff;padding:6px 10px;border-radius:8px;font-weight:800}
.langs, .navlinks{display:flex;gap:10px;flex-wrap:wrap}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #334155;background:#111a2e;color:#e5e7eb;cursor:pointer}
.btn.pri{border-color:transparent;background:linear-gradient(135deg,var(--pri),var(--pri2));color:#0b1220;font-weight:800}
.btn.small{padding:6px 10px;border-radius:10px}
.chip{background:#0f1a2e;border:1px solid var(--border);padding:6px 10px;border-radius:10px;color:var(--muted)}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px}
.grid{display:grid;gap:16px}
.grid-2{grid-template-columns:1fr 1fr}
.grid-3{grid-template-columns:repeat(3,1fr)}
label{font-weight:600;font-size:14px}
input,select,textarea{width:100%;background:#0e1629;color:#e5e7eb;border:1px solid var(--border);border-radius:10px;padding:10px 12px}
textarea{min-height:90px;resize:vertical}
.section{padding:26px 0}
h1,h2,h3,h4{margin:0 0 10px}
.muted{color:var(--muted)}
.list{display:grid;gap:12px}
.item{display:grid;gap:10px;border:1px solid var(--border);border-radius:14px;background:#0d1426;padding:12px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.price{font-weight:900}
.bad{color:#f87171}.good{color:#4ade80}
footer{border-top:1px solid var(--border);padding:20px 0;color:var(--muted);text-align:center;margin-top:28px}
@media(max-width:900px){.grid-2,.grid-3{grid-template-columns:1fr}}
</style>
</head>
<body>

<header>
  <div class="container nav">
    <div class="brand">
      <span class="badge">MB</span>
      <strong>Mazad — Bazar</strong>
    </div>

    <nav class="navlinks">
      <a class="btn small" href="#postForm" data-i="nav_add">زیادکردنی کاڵا</a>
      <a class="btn small" href="#market" data-i="nav_market">بازار</a>
      <a class="btn small" href="#admin" data-i="nav_admin">پەڕەی ئەدمین</a>
    </nav>

    <div class="langs">
      <button class="btn small" data-lang="ckb">کوردی</button>
      <button class="btn small" data-lang="ar">العربية</button>
      <button class="btn small" data-lang="en">English</button>
    </div>
  </div>
</header>

<main class="container">

  <!-- HERO -->
  <section class="section card">
    <h2 data-i="hero_title">🚀 بەخێربێن بۆ «مزاد بازار»</h2>
    <p class="muted" data-i="hero_desc">
      پۆرتاڵێکی سادەی مزایدة – نرخی سەرەتایی «٠»؛ کرێداران تەنها نرخیان زیاد دەکەن.
    </p>
    <div class="row">
      <a class="btn pri" href="#postForm" data-i="cta_add">زیادکردنی کاڵا</a>
      <a class="btn" href="#market" data-i="cta_market">بینینی بازار</a>
    </div>
  </section>

  <!-- POST FORM -->
  <section id="postForm" class="section">
    <h3 data-i="form_title">➕ زیادکردنی کاڵا</h3>
    <div class="card">
      <form id="newPostForm">
        <div class="grid grid-2">
          <div>
            <label data-i="f_name">ناوی کاڵا</label>
            <input required name="name" placeholder="مثلاً: مۆبایل S23"/>
          </div>
          <div>
            <label data-i="f_city">شار/شوێن</label>
            <input required name="city" placeholder="هەولێر / سلێمانی"/>
          </div>
          <div>
            <label data-i="f_phone">ژمارەی تەلەفون</label>
            <input required name="phone" inputmode="tel" placeholder="07xxxxxxxxx"/>
          </div>
          <div>
            <label data-i="f_img">لینکی وێنە (ئێختیاری)</label>
            <input name="image" placeholder="https://…"/>
          </div>
        </div>
        <div style="margin-top:10px">
          <label data-i="f_desc">وەسف</label>
          <textarea name="desc" placeholder="کورتە وەسفێک بنووسە…"></textarea>
        </div>

        <div class="grid grid-3" style="margin-top:10px">
          <div>
            <label data-i="f_mode">جۆری فرۆشتن</label>
            <select name="saleMode">
              <option value="auction" selected data-i="mode_auction">مزایدة</option>
              <option value="fib" data-i="mode_fib">FIB</option>
              <option value="fastbay" data-i="mode_fastbay">FastBay</option>
            </select>
          </div>
          <div>
            <label data-i="f_base">نرخی سەرەتایی</label>
            <input name="base" type="number" value="0" min="0" />
            <small class="muted" data-i="f_base_hint">خاوەنی پۆست ناتوانێت نرخی سەرەتایی زیادی بکات—«٠» پێویستە</small>
          </div>
          <div>
            <label data-i="f_step">قەدەنەی زیادبوون</label>
            <input name="step" type="number" value="1000" min="250"/>
          </div>
        </div>

        <div class="row" style="margin-top:12px">
          <button class="btn pri" type="submit" data-i="f_submit">ناردن بۆ پشکنین</button>
          <span class="chip" id="feeInfo"></span>
        </div>
        <p class="muted" style="margin-top:6px" data-i="fee_note">
          بۆ پۆستەکان بە FIB/FastBay فیسێکی خزمەتگوزاری (٢٠٠٠ دینار) هەیە.
        </p>
      </form>
    </div>
  </section>

  <!-- MARKET -->
  <section id="market" class="section">
    <h3 data-i="market_title">🛒 بازار</h3>
    <div id="marketList" class="list"></div>
  </section>

  <!-- ADMIN -->
  <section id="admin" class="section">
    <h3 data-i="admin_title">🔐 پەڕەی ئەدمین</h3>
    <div class="card">
      <div class="grid grid-3">
        <div>
          <label data-i="login_role">ڕۆڵ</label>
          <select id="roleSelect">
            <option value="viewer" selected data-i="r_viewer">بینەر</option>
            <option value="admin" data-i="r_admin">ئەدمین</option>
            <option value="super" data-i="r_super">سوپەرئەدمین</option>
          </select>
        </div>
        <div>
          <label data-i="login_user">ناو</label>
          <input id="loginUser" placeholder="username"/>
        </div>
        <div>
          <label data-i="login_pass">وشەی نهێنی</label>
          <input id="loginPass" type="password" placeholder="•••••"/>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn pri" id="btnLogin" data-i="login_btn">چۆونەژوورەوە</button>
        <span class="chip" id="loginState">guest</span>
      </div>
    </div>

    <div class="grid grid-2" style="margin-top:14px">
      <div class="card">
        <h4 data-i="admin_pending">پۆستە چاوەروانەکان</h4>
        <div id="pendingList" class="list"></div>
      </div>

      <div class="card">
        <h4 data-i="admin_tools">ئامرازەکان</h4>
        <div id="adminTools">
          <p class="muted" data-i="admin_needlogin">پێویستە بە شێوەی ئەدمین/سوپەر بچیتە ژوورەوە.</p>
        </div>
      </div>
    </div>
  </section>

</main>

<footer>
  <div>© Mazad Bazar — PWA demo. Wallet: <b>07827513551</b></div>
  <div class="muted" id="walletInfo"></div>
</footer>

<script>
/* ========= i18n ========= */
const L = {
  ckb:{
    nav_add:"زیادکردنی کاڵا", nav_market:"بازار", nav_admin:"پەڕەی ئەدمین",
    hero_title:"🚀 بەخێربێن بۆ «مزاد بازار»",
    hero_desc:"پۆرتاڵێکی سادەی مزایدة – نرخی سەرەتایی «٠»؛ کرێداران تەنها نرخیان زیاد دەکەن.",
    cta_add:"زیادکردنی کاڵا", cta_market:"بینینی بازار",

    form_title:"➕ زیادکردنی کاڵا",
    f_name:"ناوی کاڵا", f_city:"شار/شوێن", f_phone:"ژمارەی تەلەفون", f_img:"لینکی وێنە (ئێختیاری)",
    f_desc:"وەسف", f_mode:"جۆری فرۆشتن", mode_auction:"مزایدة", mode_fib:"FIB", mode_fastbay:"FastBay",
    f_base:"نرخی سەرەتایی", f_base_hint:"خاوەنی پۆست ناتوانێت نرخی سەرەتایی زیادی بکات—«٠» پێویستە",
    f_step:"قەدەنەی زیادبوون", f_submit:"ناردن بۆ پشکنین", fee_note:"بۆ پۆستەکان بە FIB/FastBay فیسێکی خزمەتگوزاری (٢٠٠٠ دینار) هەیە.",
    market_title:"🛒 بازار",

    admin_title:"🔐 پەڕەی ئەدمین", login_role:"ڕۆڵ", r_viewer:"بینەر", r_admin:"ئەدمین", r_super:"سوپەرئەدمین",
    login_user:"ناو", login_pass:"وشەی نهێنی", login_btn:"چۆونەژوورەوە",
    admin_pending:"پۆستە چاوەروانەکان", admin_tools:"ئامرازەکان", admin_needlogin:"پێویستە بە شێوەی ئەدمین/سوپەر بچیتە ژوورەوە.",

    b_approve:"پەسەندکردن", b_reject:"ڕەتکردن", reason_ph:"هۆکاری ڕەتکردن", status_pending:"چاوەروان", status_ok:"پەسەندکرا", status_no:"ڕەتکرا",
    inc:"زیادکردنی نرخ", paymsg:"بەرواری پارەدان بۆ فیس: ٢٠٠٠ دینار → 07827513551"
  },
  ar:{
    nav_add:"إضافة منتج", nav_market:"السوق", nav_admin:"لوحة الإدارة",
    hero_title:"🚀 أهلاً بك في مزاد بازار", hero_desc:"بوابة مزايدات بسيطة – السعر الابتدائي «0»، والزبائن يرفعون السعر فقط.",
    cta_add:"أضف منتجًا", cta_market:"عرض السوق",

    form_title:"➕ إضافة منتج", f_name:"اسم المنتج", f_city:"المدينة/الموقع", f_phone:"رقم الهاتف", f_img:"رابط الصورة (اختياري)",
    f_desc:"الوصف", f_mode:"طريقة البيع", mode_auction:"مزايدة", mode_fib:"FIB", mode_fastbay:"FastBay",
    f_base:"السعر الابتدائي", f_base_hint:"لا يمكن للناشر رفع السعر الابتدائي — يجب أن يكون «0».",
    f_step:"خطوة الزيادة", f_submit:"إرسال للمراجعة", fee_note:"للإعلانات FIB/FastBay توجد رسوم خدمة (2000 دينار).",
    market_title:"🛒 السوق",

    admin_title:"🔐 لوحة الإدارة", login_role:"الدور", r_viewer:"مشاهد", r_admin:"مدير", r_super:"مشرف عام",
    login_user:"المستخدم", login_pass:"كلمة المرور", login_btn:"تسجيل الدخول",
    admin_pending:"المنشورات قيد المراجعة", admin_tools:"أدوات", admin_needlogin:"سجّل دخولك كمدير/مشرف.",

    b_approve:"قبول", b_reject:"رفض", reason_ph:"سبب الرفض", status_pending:"قيد المراجعة", status_ok:"مقبول", status_no:"مرفوض",
    inc:"زيادة السعر", paymsg:"سداد رسوم الخدمة: 2000 دينار → 07827513551"
  },
  en:{
    nav_add:"Add Item", nav_market:"Market", nav_admin:"Admin",
    hero_title:"🚀 Welcome to Mazad Bazar", hero_desc:"Simple auction portal — base price is ‘0’; buyers only increase.",
    cta_add:"Add Item", cta_market:"View Market",

    form_title:"➕ Add Item", f_name:"Item name", f_city:"City/Location", f_phone:"Phone number", f_img:"Image URL (optional)",
    f_desc:"Description", f_mode:"Sale mode", mode_auction:"Auction", mode_fib:"FIB", mode_fastbay:"FastBay",
    f_base:"Base price", f_base_hint:"Owner cannot set a base price > 0 — must be ‘0’.",
    f_step:"Bid step", f_submit:"Submit for review", fee_note:"FIB/FastBay posts require a 2,000 IQD service fee.",
    market_title:"🛒 Market",

    admin_title:"🔐 Admin", login_role:"Role", r_viewer:"Viewer", r_admin:"Admin", r_super:"Super Admin",
    login_user:"Username", login_pass:"Password", login_btn:"Sign in",
    admin_pending:"Pending posts", admin_tools:"Tools", admin_needlogin:"Please sign in as admin/super admin.",

    b_approve:"Approve", b_reject:"Reject", reason_ph:"Rejection reason", status_pending:"Pending", status_ok:"Approved", status_no:"Rejected",
    inc:"Increase bid", paymsg:"Service fee due: 2,000 IQD → 07827513551"
  }
};
let lang = localStorage.getItem("mb_lang") || "ckb";
function applyI18n(){
  document.querySelectorAll("[data-i]").forEach(el=>{
    const key=el.dataset.i; el.textContent = L[lang][key] || el.textContent;
  });
  document.getElementById("feeInfo").textContent = L[lang].paymsg;
}
document.querySelectorAll("[data-lang]").forEach(b=>{
  b.onclick=()=>{lang=b.dataset.lang; localStorage.setItem("mb_lang",lang); applyI18n(); renderAll();}
});
applyI18n();

/* ========= Data (localStorage) ========= */
const DB = {
  posts: JSON.parse(localStorage.getItem("mb_posts")||"[]"),
  admins: JSON.parse(localStorage.getItem("mb_admins")||'["admin"]'),
  super: JSON.parse(localStorage.getItem("mb_super")||'["root"]'),
  wallet: JSON.parse(localStorage.getItem("mb_wallet")||'{"07827513551":0}')
};
function save(){ localStorage.setItem("mb_posts", JSON.stringify(DB.posts));
  localStorage.setItem("mb_admins", JSON.stringify(DB.admins));
  localStorage.setItem("mb_super", JSON.stringify(DB.super));
  localStorage.setItem("mb_wallet", JSON.stringify(DB.wallet));
  renderAll();
}

/* ========= Auth (demo) ========= */
let session = {role:"viewer", user:"guest"};
function login(r,u,p){
  if(r==="admin" && DB.admins.includes(u) && p==="admin123"){session={role:"admin",user:u}}
  else if(r==="super" && DB.super.includes(u) && p==="root123"){session={role:"super",user:u}}
  else if(r==="viewer"){session={role:"viewer",user:u||"guest"}}
  else {alert("⚠️ هەڵە لە تێپەڕەوشە یان ناو."); return;}
  document.getElementById("loginState").textContent = `${session.role} • ${session.user}`;
  renderAdminTools();
}
document.getElementById("btnLogin").onclick=()=>{
  login(document.getElementById("roleSelect").value,
        document.getElementById("loginUser").value.trim(),
        document.getElementById("loginPass").value.trim());
};

/* ========= New Post ========= */
document.getElementById("newPostForm").onsubmit=(e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const item = {
    id: Date.now(),
    name: fd.get("name").trim(),
    city: fd.get("city").trim(),
    phone: fd.get("phone").trim(),
    image: fd.get("image").trim(),
    desc: fd.get("desc").trim(),
    saleMode: fd.get("saleMode"),
    base: 0, // enforce
    step: Math.max(250, parseInt(fd.get("step")||"1000",10)),
    price: 0,
    status: "pending",
    reason: "",
    ownerPaid: false
  };
  // fee rule for FIB/FastBay
  if(item.saleMode!=="auction"){
    item.ownerPaid = true; // demo: mark as paid automatically
    DB.wallet["07827513551"] = (DB.wallet["07827513551"]||0) + 2000;
    alert(L[lang].paymsg + "\n(دیمۆ: وەک پارەدرا هەژمار کرا)");
  }
  DB.posts.unshift(item); save();
  e.target.reset();
  alert("✅ ناردرا بۆ پشکنین.");
};

/* ========= Market Rendering & Bidding ========= */
function postCard(p, adminView=false){
  const statusMap = {pending:L[lang].status_pending, approved:L[lang].status_ok, rejected:L[lang].status_no};
  const wrap = document.createElement("div"); wrap.className="item";
  const top = document.createElement("div"); top.className="row";
  top.innerHTML = `<strong>${p.name}</strong> <span class="chip">${p.city}</span>
                   <span class="chip">${p.phone}</span>
                   <span class="chip">${p.saleMode.toUpperCase()}</span>
                   <span class="chip ${p.status==="approved"?"good":(p.status==="rejected"?"bad":"")}">
                   ${statusMap[p.status]||p.status}</span>`;
  const img = p.image ? `<img src="${p.image}" alt="" style="max-height:140px;border-radius:10px;border:1px solid var(--border)"/>`:"";
  const desc = `<p class="muted">${p.desc||""}</p>`;
  const price = `<div class="row"><span data-i="inc"></span>:
                 <button class="btn small" data-bid="${p.id}">+${p.step.toLocaleString()}</button>
                 <span class="price">${p.price.toLocaleString()} د.ع</span></div>`;
  const reason = p.reason? `<div class="muted">📝 ${p.reason}</div>`:"";
  wrap.innerHTML = top.outerHTML + img + desc + (p.status==="approved"?price:"") + reason;

  // bid button
  wrap.querySelector("[data-bid]")?.addEventListener("click",()=>{
    p.price += p.step; save();
  });

  // admin controls
  if(adminView && (session.role==="admin" || session.role==="super")){
    const tools = document.createElement("div"); tools.className="row"; tools.style.marginTop="6px";
    const reasonInput = document.createElement("input"); reasonInput.placeholder=L[lang].reason_ph; reasonInput.value=p.reason||"";
    reasonInput.style.flex="1";
    const approve = document.createElement("button"); approve.className="btn pri small"; approve.textContent=L[lang].b_approve;
    const reject = document.createElement("button"); reject.className="btn small"; reject.textContent=L[lang].b_reject;
    approve.onclick=()=>{ p.status="approved"; p.reason=""; save(); };
    reject.onclick =()=>{ p.status="rejected"; p.reason=reasonInput.value||L[lang].reason_ph; save(); };
    tools.append(reasonInput, approve, reject);
    wrap.appendChild(tools);
  }
  return wrap;
}

function renderMarket(){
  const list = document.getElementById("marketList");
  list.innerHTML="";
  DB.posts.filter(p=>p.status==="approved").forEach(p=>list.appendChild(postCard(p,false)));
}

function renderPending(){
  const list = document.getElementById("pendingList");
  list.innerHTML="";
  DB.posts.filter(p=>p.status!=="approved").forEach(p=>list.appendChild(postCard(p,true)));
}

/* ========= Admin Tools (super-admin) ========= */
function renderAdminTools(){
  const box = document.getElementById("adminTools");
  box.innerHTML="";
  if(session.role==="viewer"){
    box.innerHTML = `<p class="muted" data-i="admin_needlogin">${L[lang].admin_needlogin}</p>`;
    return;
  }
  const adminsUI = document.createElement("div");
  adminsUI.innerHTML = `<h4>Admins</h4>
    <div class="row">
      <input id="newAdmin" placeholder="username"/>
      <button class="btn small" id="addAdmin">Add</button>
      <button class="btn small" id="delAdmin">Remove</button>
    </div>
    <div class="row" style="margin-top:6px"><span class="chip">List:</span>
      ${DB.admins.map(a=>`<span class="chip">${a}</span>`).join(" ")}
    </div>
    <hr style="border-color:var(--border)">
    <h4>Wallet</h4>
    <div class="row"><span class="chip">07827513551</span>
      <span class="chip">IQD ${ (DB.wallet["07827513551"]||0).toLocaleString() }</span>
      <button class="btn small" id="resetWallet">Reset (demo)</button>
    </div>
  `;
  box.appendChild(adminsUI);

  // only super admin can edit admins/wallet
  if(session.role!=="super"){
    box.querySelectorAll("button,input").forEach(el=>el.disabled=true);
  }else{
    document.getElementById("addAdmin").onclick=()=>{
      const u=document.getElementById("newAdmin").value.trim();
      if(u && !DB.admins.includes(u)){ DB.admins.push(u); save(); }
    };
    document.getElementById("delAdmin").onclick=()=>{
      const u=document.getElementById("newAdmin").value.trim();
      DB.admins = DB.admins.filter(x=>x!==u); save();
    };
    document.getElementById("resetWallet").onclick=()=>{
      DB.wallet["07827513551"]=0; save();
    };
  }
}

/* ========= Wallet footer ========= */
function renderWalletInfo(){
  document.getElementById("walletInfo").textContent =
    "Wallet balance (demo): IQD " + ((DB.wallet["07827513551"]||0).toLocaleString());
}

/* ========= Fees hint per mode ========= */
document.querySelector('select[name="saleMode"]').addEventListener("change", (e)=>{
  const fee = (e.target.value==="auction") ? "" : L[lang].paymsg;
  document.getElementById("feeInfo").textContent = fee;
});

/* ========= Render all ========= */
function renderAll(){ applyI18n(); renderMarket(); renderPending(); renderAdminTools(); renderWalletInfo(); }
renderAll();
</script>
</body>
</html>
